"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ts = require("typescript");
function typeCoverage(program) {
    const checker = program.getTypeChecker();
    const result = {
        knownTypes: 0,
        percentage: 100,
        totalTypes: 0,
    };
    function visit(node) {
        if (ts.isIdentifier(node) &&
            (!node.parent || (!ts.isFunctionDeclaration(node.parent) && !ts.isClassDeclaration(node.parent)))) {
            const type = checker.getTypeAtLocation(node);
            if (type) {
                result.totalTypes++;
                if (checker.typeToString(type) !== 'any') {
                    result.knownTypes++;
                }
            }
        }
        node.forEachChild(visit);
    }
    for (const sourceFile of program.getSourceFiles()) {
        if (!sourceFile.isDeclarationFile) {
            visit(sourceFile);
        }
    }
    if (result.totalTypes > 0) {
        result.percentage = (100 * result.knownTypes) / result.totalTypes;
    }
    return result;
}
exports.typeCoverage = typeCoverage;
//# sourceMappingURL=type-coverage.js.map